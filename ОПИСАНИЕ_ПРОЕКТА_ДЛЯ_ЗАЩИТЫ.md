# Полное описание проекта NartBooks

## Лендинг книжного клуба с системой управления

---

## 1. ВВЕДЕНИЕ

### 1.1. Название проекта
**NartBooks** — веб-приложение для книжного клуба, представляющее собой лендинг с системой управления книгами месяца, авторизацией пользователей и административной панелью.

### 1.2. Актуальность проекта
В современном мире книжные клубы нуждаются в удобной платформе для:
- Привлечения новых участников через информативный лендинг
- Управления списком книг месяца
- Организации встреч и обсуждений
- Взаимодействия между участниками клуба

Проект решает эти задачи, предоставляя полнофункциональное веб-приложение с разделением на клиентскую и серверную части.

### 1.3. Целевая аудитория
- **Обычные пользователи**: посетители сайта, желающие узнать о книжном клубе, просмотреть книги месяца, зарегистрироваться и участвовать в обсуждениях
- **Администраторы**: организаторы клуба, управляющие контентом, книгами месяца и пользователями

---

## 2. ЦЕЛИ И ЗАДАЧИ ПРОЕКТА

### 2.1. Основные цели
1. Создать информативный лендинг книжного клуба для привлечения новых участников
2. Реализовать систему управления книгами месяца с возможностью добавления, редактирования и удаления
3. Обеспечить авторизацию пользователей через систему кодов верификации
4. Предоставить административную панель для управления контентом и пользователями
5. Реализовать функционал избранного, отзывов и записей на встречи

### 2.2. Задачи проекта
- Разработать RESTful API на FastAPI для backend-части
- Создать современный frontend на HTML/CSS/JavaScript
- Реализовать систему авторизации через JWT токены
- Обеспечить безопасность данных и защиту от несанкционированного доступа
- Организовать структуру базы данных для хранения пользователей, книг, отзывов и избранного
- Реализовать разделение прав доступа (обычные пользователи и администраторы)

---

## 3. ФУНКЦИОНАЛ ПРОЕКТА

### 3.1. Функционал для обычных пользователей

#### 3.1.1. Главная страница (лендинг)
- Просмотр информации о книжном клубе
- Отображение текущей книги месяца с описанием
- Просмотр списка всех книг месяца с пагинацией
- Поиск книг по названию или автору
- Просмотр отзывов к книгам
- Кнопки для регистрации и входа в систему

#### 3.1.2. Авторизация
- Вход через email или телефон
- Получение кода верификации (в режиме разработки код возвращается в ответе)
- Верификация кода и получение JWT токена
- Автоматическое создание пользователя при первой авторизации
- Сохранение токена в localStorage для последующих запросов

#### 3.1.3. Личный кабинет
- Просмотр и редактирование профиля пользователя
- Управление избранными книгами
- Просмотр записанных встреч
- Просмотр оставленных отзывов

#### 3.1.4. Работа с книгами
- Просмотр детальной информации о книге
- Добавление книги в избранное
- Оставление отзывов с рейтингом
- Запись на встречу по обсуждению книги

### 3.2. Функционал для администраторов

#### 3.2.1. Административная панель
- **Управление книгами месяца:**
  - Добавление новых книг месяца
  - Редактирование существующих книг
  - Удаление книг
  - Установка текущей книги месяца
  - Просмотр статистики (количество записавшихся, средний рейтинг)

- **Управление пользователями:**
  - Просмотр списка всех пользователей с пагинацией
  - Просмотр детальной информации о пользователе
  - Изменение роли пользователя (user/admin)
  - Просмотр статистики пользователя (количество встреч, избранных книг, отзывов)

#### 3.2.2. Система ролей
- Автоматическое присвоение роли `admin` пользователям с email `admin@nartbooks.com` или `admin@nartbooks.local`
- Защита административных эндпоинтов через проверку роли
- Возможность изменения ролей пользователей через админ-панель

---

## 4. ТЕХНОЛОГИИ И АРХИТЕКТУРА

### 4.1. Backend (Серверная часть)

#### 4.1.1. Основные технологии
- **Python 3.9+** — язык программирования
- **FastAPI** — современный веб-фреймворк для создания API
- **SQLAlchemy** — ORM для работы с базой данных
- **Pydantic** — валидация данных и схемы
- **JWT (JSON Web Tokens)** — система авторизации
- **SQLite** — база данных (по умолчанию, можно заменить на PostgreSQL)

#### 4.1.2. Архитектура backend
Проект следует принципам модульной архитектуры:

```
app/
├── main.py              # Точка входа, регистрация роутеров
├── config.py            # Конфигурация (переменные окружения)
├── database.py          # Настройка подключения к БД
├── models.py            # SQLAlchemy модели (User, BookOfMonth, Review, Favorite, MeetingRegistration)
├── schemas.py           # Pydantic схемы для валидации
├── security.py          # Функции безопасности (JWT, коды верификации)
├── dependencies.py      # FastAPI зависимости (get_current_user, require_admin_role)
├── enums.py             # Перечисления (UserRole)
└── routers/             # API роутеры
    ├── auth.py          # Авторизация (send-code, verify-code)
    ├── books.py         # Книги месяца (CRUD операции)
    ├── users.py         # Пользователи (профиль, список, роли)
    ├── favorites.py     # Избранное
    ├── meetings.py      # Записи на встречи
    └── general.py      # Общие эндпоинты
```

#### 4.1.3. База данных
Структура базы данных включает следующие таблицы:

- **users** — пользователи (id, email, phone, first_name, last_name, role, и др.)
- **books_of_month** — книги месяца (id, title, author, date, location, description, is_current)
- **reviews** — отзывы к книгам (id, user_id, book_id, rating, comment)
- **favorites** — избранные книги (id, user_id, book_id)
- **meeting_registrations** — записи на встречи (id, user_id, book_id, status)
- **auth_codes** — коды верификации (identifier, code, is_used, created_at)
- **auth_tokens** — JWT токены (user_id, token, expires_at, is_active)

### 4.2. Frontend (Клиентская часть)

#### 4.2.1. Основные технологии
- **HTML5** — разметка страниц
- **CSS3** — стилизация (кастомные стили, адаптивный дизайн)
- **JavaScript (ES6+)** — интерактивность и взаимодействие с API
- **Fetch API** — HTTP запросы к backend

#### 4.2.2. Структура frontend
```
frontend-new/
├── index.html           # Главная страница (лендинг)
├── auth.html            # Страница авторизации
├── profile.html         # Личный кабинет
├── admin.html           # Административная панель
├── css/
│   └── styles.css       # Общие стили
└── js/
    ├── api.js           # Модуль для работы с API
    ├── auth.js          # Логика авторизации
    ├── main.js          # Главная страница
    ├── profile.js       # Личный кабинет
    ├── admin.js         # Административная панель
    └── form.js          # Вспомогательные функции для форм
```

#### 4.2.3. Архитектура frontend
- **Модульная структура**: каждый модуль отвечает за свою функциональность
- **API модуль**: централизованная работа с backend через `window.api`
- **Локальное хранение**: токены авторизации хранятся в `localStorage`
- **Обработка ошибок**: единообразная обработка ошибок API

### 4.3. Взаимодействие Frontend и Backend

```
Frontend (JavaScript) → HTTP запросы → Backend (FastAPI) → База данных (SQLite)
                     ← JSON ответы ←                    ←
```

- Все запросы используют JSON формат
- Авторизованные запросы включают заголовок `Authorization: Bearer <token>`
- Ошибки обрабатываются и отображаются пользователю

---

## 5. API ДОКУМЕНТАЦИЯ

### 5.1. Авторизация

#### `POST /auth/send-code`
Отправка кода верификации на email или телефон.

**Запрос:**
```json
{
  "email": "user@example.com"
}
```
или
```json
{
  "phone": "+1234567890"
}
```

**Ответ (режим разработки):**
```json
{
  "message": "Код создан (режим разработки). Сервис отправки недоступен.",
  "code": "123456",
  "dev_mode": true
}
```

#### `POST /auth/verify-code`
Верификация кода и получение JWT токена.

**Запрос:**
```json
{
  "email": "user@example.com",
  "code": "123456"
}
```

**Ответ:**
```json
{
  "message": "Авторизация успешна",
  "user_id": 1,
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer",
  "expires_in": 86400
}
```

### 5.2. Пользователи

#### `GET /me` (требует авторизации)
Получение информации о текущем пользователе.

**Заголовки:**
```
Authorization: Bearer <token>
```

**Ответ:**
```json
{
  "id": 1,
  "first_name": "Иван",
  "last_name": "Иванов",
  "email": "user@example.com",
  "phone": "+1234567890",
  "role": "user",
  "fav_authors": ["Толстой", "Достоевский"],
  "fav_genres": ["Классика", "Фантастика"]
}
```

#### `PATCH /me` (требует авторизации)
Обновление профиля пользователя.

#### `GET /users` (только для админов)
Получение списка пользователей с пагинацией.

#### `GET /users/{id}` (только для админов)
Получение детальной информации о пользователе.

#### `PUT /users/{id}/role` (только для админов)
Изменение роли пользователя.

### 5.3. Книги месяца

#### `GET /books/current`
Получение текущей книги месяца.

#### `GET /books`
Получение списка книг с пагинацией и поиском.

**Параметры запроса:**
- `page` (int) — номер страницы (по умолчанию 1)
- `limit` (int) — количество на странице (по умолчанию 10)
- `search` (string) — поиск по названию или автору

#### `GET /books/{id}`
Получение детальной информации о книге.

#### `POST /books` (только для админов)
Добавление новой книги месяца.

#### `PUT /books/{id}` (только для админов)
Обновление книги месяца.

#### `DELETE /books/{id}` (только для админов)
Удаление книги месяца.

#### `PUT /books/{id}/set-current` (только для админов)
Установка книги как текущей книги месяца.

### 5.4. Отзывы

#### `GET /books/{id}/reviews`
Получение списка отзывов к книге.

#### `POST /books/{id}/reviews` (требует авторизации)
Добавление отзыва к книге.

### 5.5. Избранное

#### `GET /favorites` (требует авторизации)
Получение списка избранных книг пользователя.

#### `POST /favorites` (требует авторизации)
Добавление книги в избранное.

#### `DELETE /favorites/{book_id}` (требует авторизации)
Удаление книги из избранного.

### 5.6. Встречи

#### `POST /meetings/register/{book_id}` (требует авторизации)
Запись на встречу по обсуждению книги.

#### `DELETE /meetings/register/{book_id}` (требует авторизации)
Отмена записи на встречу.

#### `GET /meetings/my` (требует авторизации)
Получение списка встреч, на которые записан пользователь.

---

## 6. СИСТЕМА БЕЗОПАСНОСТИ

### 6.1. Авторизация через JWT токены
- Токены имеют ограниченное время жизни (24 часа по умолчанию)
- Токены хранятся в базе данных для возможности отзыва
- Используется алгоритм HS256 для подписи токенов
- Секретный ключ хранится в переменных окружения

### 6.2. Защита административных эндпоинтов
- Проверка роли пользователя через зависимость `require_admin_role`
- Только пользователи с ролью `admin` могут выполнять административные операции
- Автоматическое присвоение роли `admin` только для определенных email адресов

### 6.3. Валидация данных
- Все входные данные валидируются через Pydantic схемы
- Защита от SQL-инъекций через использование ORM
- Экранирование HTML на frontend для защиты от XSS

### 6.4. Обработка ошибок
- Единообразная обработка ошибок на всех уровнях
- Информативные сообщения об ошибках для пользователя
- Логирование ошибок для администраторов

---

## 7. ПРОЦЕСС РАЗРАБОТКИ

### 7.1. Инструменты разработки
- **Ruff** — линтер и форматтер кода Python
- **Pre-commit hooks** — автоматические проверки перед коммитом
- **Swagger UI** — интерактивная документация API
- **Git** — система контроля версий

### 7.2. Качество кода
- Следование PEP 8 для Python кода
- Модульная структура для легкого сопровождения
- Комментарии и документация в коде
- Обработка исключений на всех уровнях

### 7.3. Тестирование
- Ручное тестирование всех функций
- Проверка работы API через Swagger UI
- Тестирование авторизации и прав доступа

---

## 8. ЗАПУСК ПРОЕКТА

### 8.1. Требования
- Python 3.9+
- pip
- Веб-браузер

### 8.2. Установка и запуск Backend

1. Установить зависимости:
```bash
pip install -r requirements.txt
```

2. Настроить переменные окружения (создать файл `.env`):
```env
DATABASE_URL=sqlite:///./nartbooks.db
JWT_SECRET_KEY=your-secret-key-here
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24
```

3. Запустить сервер:
```bash
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```

Backend будет доступен на: http://localhost:8000
Документация API: http://localhost:8000/docs

### 8.3. Запуск Frontend

1. Перейти в директорию frontend:
```bash
cd frontend-new
```

2. Запустить HTTP сервер:
```bash
python -m http.server 8080
```

Frontend будет доступен на: http://localhost:8080

### 8.4. Создание администратора

При первой авторизации с email `admin@nartbooks.com` пользователь автоматически получит роль `admin`.

Или использовать скрипт:
```bash
python scripts/create_admin.py --email admin@nartbooks.com
```

---

## 9. РЕЗУЛЬТАТЫ ПРОЕКТА

### 9.1. Реализованный функционал
✅ Полнофункциональный лендинг книжного клуба
✅ RESTful API с документацией
✅ Система авторизации через JWT токены
✅ Административная панель для управления контентом
✅ Система ролей и прав доступа
✅ Управление книгами месяца (CRUD операции)
✅ Избранное, отзывы, записи на встречи
✅ Адаптивный дизайн frontend
✅ Безопасность данных и защита от несанкционированного доступа

### 9.2. Технические достижения
- Модульная архитектура для легкого расширения
- Разделение frontend и backend
- Использование современных технологий и практик
- Качественный код с обработкой ошибок
- Документация API через Swagger UI

### 9.3. Возможности для развития
- Интеграция с реальным сервисом отправки SMS/Email
- Расширенная система уведомлений
- Мобильное приложение
- Социальные функции (комментарии, лайки)
- Расширенная аналитика для администраторов
- Многоязычность
- Интеграция с платежными системами

---

## 10. ВЫВОДЫ

Проект **NartBooks** представляет собой полнофункциональное веб-приложение для книжного клуба, объединяющее информативный лендинг и систему управления контентом. 

Реализованы все основные функции:
- Привлечение новых участников через лендинг
- Управление книгами месяца
- Авторизация и личные кабинеты пользователей
- Административная панель для управления системой

Проект демонстрирует навыки работы с современными веб-технологиями, понимание архитектуры веб-приложений, реализацию безопасности и создание удобного пользовательского интерфейса.

Приложение готово к использованию и может быть развернуто в production среде после настройки соответствующих параметров безопасности и базы данных.

---

## 11. ТЕХНИЧЕСКИЕ ДЕТАЛИ

### 11.1. Основные зависимости Backend
- fastapi — веб-фреймворк
- uvicorn — ASGI сервер
- sqlalchemy — ORM
- pydantic — валидация данных
- python-jose — JWT токены
- python-multipart — работа с формами

### 11.2. Структура базы данных
- SQLite для разработки (легко заменить на PostgreSQL)
- Автоматическое создание таблиц при первом запуске
- Миграции через SQLAlchemy

### 11.3. Конфигурация
- Все настройки через переменные окружения
- Файл `.env` для локальной разработки
- Пример конфигурации в `.env.example`

---

**Дата создания документа:** 2024
**Версия проекта:** 1.0
**Статус:** Готов к защите
