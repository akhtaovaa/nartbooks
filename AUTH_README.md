# Система авторизации NartBooks

## Обзор

В приложение добавлена система JWT токенов для авторизации пользователей. После успешной верификации кода пользователь получает токен авторизации.

## Как это работает

### 1. Отправка кода верификации
```
POST /auth/send-code
{
    "email": "user@example.com"  // или "phone": "+1234567890"
}
```

### 2. Верификация кода и получение токена
```
POST /auth/verify-code
{
    "email": "user@example.com",  // или "phone": "+1234567890"
    "code": "123456"
}
```

**Ответ:**
```json
{
    "message": "Авторизация успешна",
    "user_id": 1,
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
    "token_type": "bearer",
    "expires_in": 86400
}
```

### 3. Использование токена для авторизованных запросов

Добавьте заголовок `Authorization` с токеном:
```
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
```

### 4. Получение информации о текущем пользователе
```
GET /me
Authorization: Bearer <your_token>
```

## Настройки

- **JWT_SECRET_KEY**: Секретный ключ для подписи токенов (в продакшене используйте более безопасный ключ)
- **JWT_EXPIRATION_HOURS**: Время жизни токена (по умолчанию 24 часа)
- **JWT_ALGORITHM**: Алгоритм подписи (HS256)

## Безопасность

- Токены имеют ограниченное время жизни
- Токены сохраняются в базе данных для возможности отзыва
- Используется стандартный JWT с HMAC-SHA256
- Токены передаются только через HTTPS в продакшене

## Роли пользователей

Система поддерживает две роли:
- **user** - обычный пользователь (роль по умолчанию)
- **admin** - администратор (может добавлять книги месяца и управлять ролями)

## Эндпоинты API

### Авторизация
- `POST /auth/send-code` - отправка кода верификации
- `POST /auth/verify-code` - верификация кода и получение токена

### Пользователи
- `GET /me` - получение информации о текущем пользователе (требует авторизации)

### Книги
- `GET /book_of_month` - получение книги месяца

### Администрирование (только для администраторов)
- `POST /admin/add_book` - добавление книги месяца
- `POST /admin/update_role` - обновление роли пользователя

### Скрытые эндпоинты
- `POST /register` - регистрация пользователя (скрыт из документации)
